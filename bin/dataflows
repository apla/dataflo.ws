#!/usr/local/bin/node

var path = require('path');
var common = require('dataflo.ws/common');

var projectRoot = path.resolve(process.argv[2] || process.cwd());
var initiatorTypes = process.argv.slice(3);

var project = common.getProject(projectRoot);
common.$global.project = project; // used by initiators

project.on('ready', function () {
	// initiate all daemons if no arguments passed
	if (0 == initiatorTypes.length) {
		initiatorTypes = Object.keys(project.config.initiator);
	}

	initiatorTypes.forEach(function (type) {
		var Initiator = require('dataflo.ws/initiator/' + type);
		if ('function' == typeof Initiator) {
			new Initiator(project.config.initiator[type]);
		}
	});
});
