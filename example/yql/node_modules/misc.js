var Buffer = require('buffer');

module.exports = {
	pimp: function (str) {
		return str.toLowerCase();
	},

	unPimp: function (str) {
		return str.toUpperCase();
	},

	stripTags: function (text) {
		var Entities = {
			'<': '&lt;',
			'>': '&rt;'
		};
		var tagsRe = new RegExp(Object.keys(Entities).join('|'), 'g');
		var toEntity = function (s) { return Entities[s]; };
		return text.replace(tagsRe, toEntity);
	},

	formatData: function (text, response) {
		var json = response.data.toString();
		var data = JSON.parse(json);
		var results = data.query.results;

		if (results) {
			var wiki_url = results.wiki_url;
			var related_entities = results.related_entities;
			var items = results.entities.entity;

			if (Array != items.constructor) {
				items = [ items ];
			}
		}

		return {
			text: this.stripTags(text),
			items: items || null,
			wiki_url: wiki_url || null,
			related_entities: related_entities || null
		};
	}
};
