<!DOCTYPE html>
<html>
	<head>
		<script src="require-browser.js"></script>
		<script src="common.js" onload="applyExports (this);"></script>
		<script src="task/base.js" onload="applyExports (this);"></script>
		<script src="task/sleep.js" onload="applyExports (this);"></script>
		<script src="workflow.js" onload="applyExports (this);"></script>
		<script src="initiator/callback.js" onload="applyExports (this);"></script>
		<script type="text/javascript">
			var cbi = require ('initiator/callback');
			var okWorkflow = new cbi ({
				workflows: [{
					token: "ok",
					tasks: [{
						functionName: "parseJSON",
						from: "{$request.json}",
						produce: "data.jsonData"
					}, {
						className: "sleep",
						amount: 3000,
						temp: "{$data.jsonData}",
						produce: "data.awaken"
					}, {
						functionName: "logData",
						data: "{$data.jsonData}",
						ready: "{$data.awaken}"
//						produce: "jsonData"
					}]
				}]
			});

			function parseJSON (config) {
				return JSON.parse (config.from);
			}

			function logData (config) {
				return console.log (config.data);
			}

			
			okWorkflow.process ("ok", {json: '{"a": "b"}'});
			
			okWorkflow.process ("ok", {json: '{"c": "d"}'});
			
		</script>
		
		
	</head>
	<body>
		<h1></h1>
	</body>
</html>
